<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iMovieHUB</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background:#0f0f0f;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
}

/* NAVBAR */
.navbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 20px;
  background:#000;
  position:sticky;
  top:0;
  z-index:100;
}
.logo { color:#e50914; font-size:24px; font-weight:bold; }
.search-bar {
  padding:6px 10px;
  border-radius:6px;
  border:none;
  width:200px;
}

/* BANNER */
.banner {
  height:45vh;
  background:linear-gradient(to top,#000,transparent),
  url("https://images.unsplash.com/photo-1517602302552-471fe67acf66") center/cover;
  display:flex;
  align-items:flex-end;
  padding:20px;
}
.banner h1 { font-size:34px; }

/* ROWS */
.row { margin:20px; }
.row h2 { margin-bottom:10px; font-size:20px; }
.list {
  display:flex;
  gap:10px;
  overflow-x:auto;
  scrollbar-width:none;
}
.list::-webkit-scrollbar{display:none;}

.card {
  min-width:120px;
  cursor:pointer;
  position:relative;
}
.card img {
  width:100%;
  border-radius:6px;
}
.favorite {
  position:absolute;
  top:6px;
  right:6px;
  color:#fff;
  font-size:16px;
}

/* MODAL */
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:1000;
}
.modal-content {
  max-width:900px;
  margin:auto;
  padding:20px;
}
.close {
  font-size:26px;
  cursor:pointer;
  text-align:right;
}
.modal-body {
  display:flex;
  gap:16px;
}
.modal-body img {
  width:180px;
  border-radius:6px;
}
.modal-text p {
  opacity:.85;
  margin-top:8px;
}
button {
  padding:8px 14px;
  margin-top:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.trailer-btn { background:#e50914; color:#fff; }
.fav-btn { background:#333; color:#fff; }

/* MOBILE */
@media(max-width:768px){
  .search-bar{width:120px;}
  .modal-body{flex-direction:column;align-items:center;}
  .card{min-width:100px;}
}
</style>
</head>

<body>

<div class="navbar">
  <div class="logo">üé¨ iMovieHUB</div>
  <input id="search" class="search-bar" placeholder="Search movies...">
</div>

<div class="banner">
  <h1>Discover Movies</h1>
</div>

<div class="row">
  <h2>Movies</h2>
  <div class="list" id="movies"></div>
</div>

<div class="row">
  <h2>‚ù§Ô∏è Favorites</h2>
  <div class="list" id="favorites"></div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="close" onclick="closeModal()">‚úñ</div>
    <div class="modal-body">
      <img id="modal-img">
      <div class="modal-text">
        <h3 id="modal-title"></h3>
        <p id="modal-rating"></p>
        <p id="modal-desc"></p>
        <button class="trailer-btn" onclick="playTrailer()">üé¨ Trailer</button>
        <button class="fav-btn" onclick="toggleFavorite()">‚ù§Ô∏è Favorite</button>
      </div>
    </div>
    <iframe id="trailer" width="100%" height="400" style="display:none;margin-top:15px;"></iframe>
  </div>
</div>

<script>
const API_KEY = "0929d17296f3c3e69d36b336e02da9c7";
const IMG = "https://image.tmdb.org/t/p/w500";
let page = 1;
let currentMovie = null;
let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

/* LOAD MOVIES */
function loadMovies() {
  fetch(`https://api.themoviedb.org/3/trending/movie/week?page=${page}&api_key=${API_KEY}`)
  .then(r=>r.json())
  .then(d=>{
    d.results.forEach(m=>{
      if(!m.poster_path) return;
      document.getElementById("movies").innerHTML += `
      <div class="card" onclick='openModal(${JSON.stringify(m)})'>
        <img src="${IMG+m.poster_path}">
        <div class="favorite">‚ù§Ô∏è</div>
      </div>`;
    });
    page++;
  });
}
loadMovies();

/* INFINITE SCROLL */
window.addEventListener("scroll",()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight-300){
    loadMovies();
  }
});

/* SEARCH */
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value;
  if(!q) return;
  fetch(`https://api.themoviedb.org/3/search/movie?query=${q}&api_key=${API_KEY}`)
  .then(r=>r.json())
  .then(d=>{
    document.getElementById("movies").innerHTML="";
    d.results.forEach(m=>{
      if(!m.poster_path) return;
      document.getElementById("movies").innerHTML += `
      <div class="card" onclick='openModal(${JSON.stringify(m)})'>
        <img src="${IMG+m.poster_path}">
      </div>`;
    });
  });
});

/* MODAL */
function openModal(movie){
  currentMovie = movie;
  document.getElementById("modal").style.display="block";
  document.getElementById("modal-title").innerText = movie.title;
  document.getElementById("modal-desc").innerText = movie.overview || "No description";
  document.getElementById("modal-rating").innerText = "‚≠ê "+movie.vote_average;
  document.getElementById("modal-img").src = IMG+movie.poster_path;
  document.getElementById("trailer").style.display="none";
}

/* TRAILER */
function playTrailer(){
  fetch(`https://api.themoviedb.org/3/movie/${currentMovie.id}/videos?api_key=${API_KEY}`)
  .then(r=>r.json())
  .then(d=>{
    const t = d.results.find(v=>v.type==="Trailer");
    if(t){
      document.getElementById("trailer").src =
      `https://www.youtube.com/embed/${t.key}`;
      document.getElementById("trailer").style.display="block";
    }
  });
}

/* FAVORITES */
function toggleFavorite(){
  if(!favorites.find(f=>f.id===currentMovie.id)){
    favorites.push(currentMovie);
  } else {
    favorites = favorites.filter(f=>f.id!==currentMovie.id);
  }
  localStorage.setItem("favorites",JSON.stringify(favorites));
  renderFavorites();
}
function renderFavorites(){
  const f = document.getElementById("favorites");
  f.innerHTML="";
  favorites.forEach(m=>{
    f.innerHTML+=`
    <div class="card" onclick='openModal(${JSON.stringify(m)})'>
      <img src="${IMG+m.poster_path}">
    </div>`;
  });
}
renderFavorites();

/* CLOSE */
function closeModal(){
  document.getElementById("modal").style.display="none";
  document.getElementById("trailer").src="";
}
</script>

</body>
</html>
